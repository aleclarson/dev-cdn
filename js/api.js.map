{
  "version": 3,
  "file": "api.js",
  "sourceRoot": "..",
  "sources": [
    "src/api.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "EventStream = require './EventStream'\nmimeTypes = require 'mime-types'\nRouter = require 'yiss'\napp = require './app'\nfs = require './fs'\n\napi = new Router\n\napi.listen (req, res) ->\n\n  if name = req.get 'x-bucket'\n    unless req.bucket = app.buckets[name]\n      res.status 404\n      return error: 'Unknown bucket: ' + name\n\n  else if name = req.get 'x-project'\n    unless req.project = app.projects[name]\n      res.status 404\n      return error: 'Unknown project: ' + name\n\n  else\n    res.status 400\n    return error: \"Missing both 'X-Bucket' and 'X-Project' headers\"\n\napi.GET '/b/assets.json', (req, res) ->\n  if req.accepts 'text/event-stream'\n\n    if req.file isnt 'assets.json'\n      res.set 'Error', 'Unknown event stream'\n      return 404\n\n    if req.bucket\n      req.bucket.events.pipe res\n      return true\n    return 404\n\napi.PATCH '/b/assets.json', (req) ->\n  if req.bucket\n    req.bucket.patch await req.json()\n    return true\n  return 404\n\n# TODO: Support source maps.\napi.GET '/b/**/*.map', -> '{}'\n\napi.GET '/b/:file(.+)', (req, res) ->\n  req.file = req.params.file\n  file = req.bucket?.get req.file\n  file ?= await app.read req, res\n  return if res.headersSent\n  return 404 unless file\n\n  contentLength =\n    if typeof file is 'string'\n    then Buffer.byteLength file\n    else fs.stat(file.path).size\n\n  res.set\n    'Content-Type': mimeTypes.lookup(req.file) or 'application/octet-stream'\n    'Content-Length': contentLength\n    'Cache-Control': 'no-store'\n  res.flushHeaders()\n\n  if typeof file is 'string'\n  then res.send file\n  else file.pipe res\n  return true\n\nmodule.exports = api.bind()\n"
  ]
}